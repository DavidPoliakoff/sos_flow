#!/bin/bash
if [ -z $1 ]; then echo "   >>> BATCH MODE!"; fi;
if [ -z $1 ]; then echo "   >>> Starting the sosd daemons..."; fi;
./mpi.cleanall
if [ -z $1 ]; then echo "   >>> Launching the sosd daemons..."; fi;

# TAU: daemon0="-np 1 tau_exec -io -memory_debug ../bin/sosd --role SOS_ROLE_DAEMON --port 22500 --buffer_len 2048 --listen_backlog 10 --work_dir $(pwd)"
# TAU: daemon1="-np 1 tau_exec -io -memory_debug ../bin/sosd --role SOS_ROLE_DB     --port 22503 --buffer_len 2048 --listen_backlog 10 --work_dir $(pwd)"

daemon0="-np 1 ../bin/sosd --role SOS_ROLE_DAEMON --port 22500 --buffer_len 4096000 --listen_backlog 10 --work_dir $(pwd)"
daemon1="-np 1 ../bin/sosd --role SOS_ROLE_DB     --port 22503 --buffer_len 4096000 --listen_backlog 10 --work_dir $(pwd)"


echo ${daemon0}
echo ${daemon1}

#GOOD:   valgrind --tool=memcheck --leak-check=full --show-leak-kinds=all --trace-children=yes mpirun ${daemon0} : ${daemon1}
#BETTER: valgrind --tool=memcheck --trace-children=yes --track-origins=yes mpirun ${daemon0} : ${daemon1}

mpirun ${daemon0} : ${daemon1}
